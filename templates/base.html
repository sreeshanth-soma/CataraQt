<!DOCTYPE html>
<html lang="en" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}{% endblock %}</title>
    <link
      href="{{ url_for('static', filename='css/output.css') }}"
      rel="stylesheet"
    />
    {% block head_extra %}{% endblock %}
    <style>
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInRight {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .animate-fade-up {
        animation: fadeInUp 0.5s ease-out forwards;
      }

      .animate-slide-right {
        animation: slideInRight 0.5s ease-out forwards;
      }

      .nav-link {
        transition: all 0.3s ease;
      }

      .nav-link:hover {
        transform: translateY(-2px);
      }

      .btn-primary {
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      /* Modern color scheme */
      .text-blue-600 {
        color: #4f46e5 !important;
      }

      .hover\:text-blue-700:hover {
        color: #4338ca !important;
      }

      .hover\:text-blue-600:hover {
        color: #4f46e5 !important;
      }

      .bg-blue-600 {
        background-color: #4f46e5 !important;
      }

      .hover\:bg-blue-700:hover {
        background-color: #4338ca !important;
      }

      .border-blue-500 {
        border-color: #6366f1 !important;
      }

      /* Dark mode styles */
      .dark body {
        background-color: #0f172a;
        color: #e2e8f0;
      }

      /* Navigation and general UI */
      .dark .bg-white {
        background-color: #1e293b;
      }

      .dark .text-gray-500 {
        color: #94a3b8;
      }

      .dark .text-gray-700 {
        color: #e2e8f0;
      }

      .dark .text-gray-800 {
        color: #f7fafc;
      }

      .dark .text-gray-900 {
        color: #f7fafc;
      }

      .dark .text-gray-400 {
        color: #a0aec0;
      }

      /* Cards and containers */
      .dark .bg-white\/80 {
        background-color: rgba(30, 41, 59, 0.8);
      }

      .dark .bg-white\/90 {
        background-color: rgba(30, 41, 59, 0.9);
      }

      .dark .bg-gray-50 {
        background-color: #0f172a;
      }

      .dark .bg-gray-100 {
        background-color: #1e293b;
      }

      .dark .bg-gray-200 {
        background-color: #334155;
      }

      /* Update nav links in dark mode */
      .dark .text-blue-600,
      .dark .hover\:text-blue-600:hover {
        color: #818cf8 !important;
      }

      .dark .bg-blue-600 {
        background-color: #6366f1 !important;
      }

      .dark .hover\:bg-blue-700:hover {
        background-color: #4f46e5 !important;
      }

      /* Interactive elements */
      .dark .hover\:bg-gray-50:hover {
        background-color: #2d2d2d;
      }

      .dark .hover\:bg-gray-100:hover {
        background-color: #374151;
      }

      .dark .hover\:text-gray-500:hover {
        color: #e2e8f0;
      }

      .dark .hover\:bg-white\/70:hover {
        background-color: rgba(45, 45, 45, 0.7);
      }

      /* Form elements */
      .dark input,
      .dark textarea {
        background-color: #2d2d2d;
        border-color: #4a5568;
        color: #e2e8f0;
      }

      .dark input:focus,
      .dark textarea:focus {
        border-color: #63b3ed;
      }

      /* Tables */
      .dark table {
        background-color: #2d2d2d;
        color: #e2e8f0;
      }

      .dark th {
        background-color: #374151;
      }

      .dark td {
        border-color: #4a5568;
      }

      /* Alert messages */
      .dark .bg-red-100 {
        background-color: rgba(220, 38, 38, 0.2);
      }

      .dark .text-red-700 {
        color: #f87171;
      }

      .dark .bg-green-100 {
        background-color: rgba(16, 185, 129, 0.2);
      }

      .dark .text-green-700 {
        color: #34d399;
      }

      /* Dashboard specific */
      .dark .bg-blue-50 {
        background-color: rgba(59, 130, 246, 0.1);
      }

      .dark .bg-yellow-50 {
        background-color: rgba(251, 191, 36, 0.1);
      }

      .dark .bg-green-50 {
        background-color: rgba(16, 185, 129, 0.1);
      }

      .dark .bg-red-50 {
        background-color: rgba(239, 68, 68, 0.1);
      }

      /* Charts and visualizations */
      .dark canvas {
        background-color: #2d2d2d;
      }

      /* Loading states */
      .dark .bg-gray-900.bg-opacity-50 {
        background-color: rgba(0, 0, 0, 0.7);
      }

      /* Transitions */
      .dark * {
        transition-property: background-color, border-color, color, fill, stroke;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 150ms;
      }

      /* Override inline styles in dark mode for navbar links */
      html.dark .nav-link {
        color: white !important;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen flex flex-col">
    <!-- Navigation -->
    <nav
      class="bg-white dark:bg-gray-800 shadow-lg sticky top-0 z-50 animate-fade-up"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <!-- Left side with logo and navigation links -->
          <div class="flex items-center">
            <div class="flex-shrink-0 flex items-center">
              <a
                href="{{ url_for('index') }}"
                class="text-2xl font-bold text-blue-600 hover:text-blue-700 transition-colors duration-300"
              >
                CataraQt
              </a>
            </div>
            <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
              <a
                href="{{ url_for('index') }}"
                class="nav-link border-transparent text-gray-500 dark:text-white hover:border-blue-500 hover:text-blue-600 dark:hover:text-blue-400 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-all duration-300 hover:-translate-y-0.5"
              >
                Home
              </a>
              {% if session.get('user_id') %}
              <a
                href="{{ url_for('analyze_image') }}"
                class="nav-link border-transparent text-gray-500 dark:text-white hover:border-blue-500 hover:text-blue-600 dark:hover:text-blue-400 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-all duration-300 hover:-translate-y-0.5"
              >
                Analyze
              </a>
              {% endif %}
            </div>
          </div>

          <!-- Right-side container with theme toggle and links -->
          <div class="flex items-center space-x-4">
            <!-- Theme Toggle -->
            <button
              id="theme-toggle"
              class="nav-link text-gray-500 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 p-2 rounded-lg transition-all duration-300 hover:-translate-y-0.5"
              aria-label="Toggle dark mode"
            >
              <!-- Sun icon -->
              <svg
                id="light-icon"
                class="w-5 h-5 hidden"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                ></path>
              </svg>
              <!-- Moon icon -->
              <svg
                id="dark-icon"
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                ></path>
              </svg>
            </button>

            {% if session.get('user_id') %}
            <!-- Logged-in menu items -->
            <span
              class="text-gray-700 dark:text-white text-sm font-medium animate-slide-right"
            >
              Welcome, {{ session.get('user_name', session.get('user_id')) }}
            </span>
            <a
              href="{{ url_for('dashboard') }}"
              class="nav-link text-gray-500 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-all duration-300 hover:-translate-y-0.5"
            >
              Dashboard
            </a>
            <a
              href="{{ url_for('logout') }}"
              class="nav-link text-gray-500 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-all duration-300 hover:-translate-y-0.5"
            >
              Logout
            </a>
            {% else %}
            <!-- Logged-out menu items -->
            <a
              href="{{ url_for('login') }}"
              class="nav-link text-gray-500 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-all duration-300 hover:-translate-y-0.5"
            >
              Login
            </a>
            <a
              href="{{ url_for('register') }}"
              class="btn-primary bg-blue-600 text-white hover:bg-blue-700 px-4 py-2 rounded-md text-sm font-medium shadow-md transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg"
            >
              Register
            </a>
            {% endif %}
          </div>
        </div>
      </div>
    </nav>

    <!-- Profile Icon (completely separate, using forced right positioning) -->
    {% if session.get('user_id') %}
    <a href="{{ url_for('profile') }}" class="profile-button-right">
      {% if session.get('user_profile_picture') %}
      <img
        class="h-8 w-8 rounded-full object-cover hover:ring-2 hover:ring-blue-500 hover:ring-offset-2 dark:hover:ring-offset-gray-800 transition-all duration-300"
        src="{{ url_for('serve_upload', filename=session.get('user_profile_picture')) }}"
        alt="User profile picture"
      />
      {% else %}
      <img
        class="h-8 w-8 rounded-full object-cover hover:ring-2 hover:ring-blue-500 hover:ring-offset-2 dark:hover:ring-offset-gray-800 transition-all duration-300"
        src="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgdmlld0JveD0iMCAwIDI0IDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyIiBkPSJNMTYgN2ExNSA0IDAgMTEtOCAwbCA0IDAgMTEtOCAwem0wIDdhNSA1IDAgMDA1IDV2MWEyIDIgMCAwMS0yIDJIMTAuOTg0YTIgMiAwIDAxLTEuOTg0LTEuNzU2bC0uMDAxLS4wMDRBNSA1IDAgMDAxNiAxNHoiLz48L3N2Zz4="
        alt="User profile picture"
      />
      {% endif %}
    </a>
    {% endif %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
      {% for category, message in messages %}
      <div
        class="animate-slide-right rounded-md p-4 mb-4 {% if category == 'error' %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}"
      >
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <!-- Main Content -->
    <main class="flex-grow animate-fade-up">
      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-white mt-12 animate-fade-up">
      <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
        <div
          class="mt-8 border-t border-gray-200 pt-8 md:flex md:items-center md:justify-between"
        >
          <div class="flex space-x-6 md:order-2">
            <a
              href="https://github.com/yourusername/cataraqt"
              class="text-gray-400 hover:text-gray-500 transition-colors duration-300"
            >
              <span class="sr-only">GitHub</span>
              <svg
                class="h-6 w-6"
                fill="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  fill-rule="evenodd"
                  d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                  clip-rule="evenodd"
                />
              </svg>
            </a>
          </div>
          <p class="mt-8 text-base text-gray-400 md:mt-0 md:order-1">
            &copy; 2024 CataraQt. All rights reserved.
          </p>
        </div>
      </div>
    </footer>

    {% block scripts %}{% endblock %}

    <!-- Dark mode script -->
    <script>
      // Check for saved theme preference, otherwise use system preference
      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
        document.getElementById("light-icon").classList.remove("hidden");
        document.getElementById("dark-icon").classList.add("hidden");
      } else {
        document.documentElement.classList.remove("dark");
        document.getElementById("light-icon").classList.add("hidden");
        document.getElementById("dark-icon").classList.remove("hidden");
      }

      // Theme toggle button
      document
        .getElementById("theme-toggle")
        .addEventListener("click", function () {
          if (document.documentElement.classList.contains("dark")) {
            document.documentElement.classList.remove("dark");
            localStorage.theme = "light";
            document.getElementById("light-icon").classList.add("hidden");
            document.getElementById("dark-icon").classList.remove("hidden");
          } else {
            document.documentElement.classList.add("dark");
            localStorage.theme = "dark";
            document.getElementById("light-icon").classList.remove("hidden");
            document.getElementById("dark-icon").classList.add("hidden");
          }

          // If Vanta.js is initialized, update its colors
          if (window.VANTA) {
            const currentEffect = window.currentVantaEffect;
            if (currentEffect) {
              // We don't need to set background color here,
              // let the Vanta effect handle it based on its config.
              // const isDark =
              //   document.documentElement.classList.contains("dark");
              // currentEffect.setOptions({
              //   backgroundColor: isDark ? 0x151515 : 0x202428,
              // });
            }
          }
        });
    </script>
  </body>
</html>
